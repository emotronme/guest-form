<script>
  let guestCount = 0;

  function addGuest() {
    guestCount++;
    const container = document.getElementById("guestContainer");

    const guestDiv = document.createElement("div");
    guestDiv.className = "guest-block";
    const blockId = `guest-${guestCount}`;
    
    guestDiv.innerHTML = `
      <label>Guest ${guestCount} Name:</label>
      <input type="text" name="name" placeholder="Enter guest name" required />

      <label>Choose drink:</label>
      <select name="drink" onchange="toggleSugar(this)">
        <option value="Cappuccino">Cappuccino</option>
        <option value="Flat White">Flat White</option>
        <option value="Americano">Americano</option>
        <option value="Espresso">Espresso</option>
        <option value="Black Coffee">Black Coffee</option>
        <option value="Black Tea">Black Tea</option>
        <option value="Water">Water</option>
      </select>

      <div class="sugar-block">
        <label>Sugar preference:</label>
        <select name="sugar">
          <option value="With Sugar">With Sugar</option>
          <option value="Without Sugar">Without Sugar</option>
        </select>
      </div>
    `;
    container.appendChild(guestDiv);
  }

  // Add one guest by default
  addGuest();

  function toggleSugar(selectEl) {
    const sugarBlock = selectEl.closest(".guest-block").querySelector(".sugar-block");
    if (selectEl.value === "Water") {
      sugarBlock.style.display = "none";
    } else {
      sugarBlock.style.display = "block";
    }
  }

  document.getElementById("orderForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const phone = '971529436936'; // Update as needed
    const guestBlocks = document.querySelectorAll(".guest-block");
    let message = "New Guest Refreshment Orders:%0A";

    guestBlocks.forEach((block, index) => {
      const name = block.querySelector('input[name="name"]').value.trim();
      const drink = block.querySelector('select[name="drink"]').value;
      const sugarBlock = block.querySelector('.sugar-block');
      const sugar = sugarBlock.style.display !== "none"
        ? sugarBlock.querySelector('select[name="sugar"]').value
        : null;

      if (name) {
        message += `%0AGuest ${index + 1}:%0AName: ${name}%0ADrink: ${drink}`;
        if (sugar) message += `%0ASugar: ${sugar}`;
        message += `%0A------------------`;
      }
    });

    const url = `https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(message)}`;
    window.open(url, '_blank');
  });
</script>
